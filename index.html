import React, { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

const initialVocabulary = [
  { english: 'Dreidel', hebrew: '住' },
  { english: 'Hanukkah', hebrew: '' },
  { english: 'Menorah', hebrew: '专', alternativeAnswers: [''] },
  { english: 'Doughnuts', hebrew: '住驻转' },
  { english: 'Flour', hebrew: '拽' },
  { english: 'Sugar', hebrew: '住专' },
  { english: 'Oil', hebrew: '砖' },
  { english: 'Jam', hebrew: '专' },
  { english: 'Fry', hebrew: '' },
  { english: 'Pan', hebrew: '转' }
];

const EnglishLearningApp = () => {
  const [vocabulary, setVocabulary] = useState([...initialVocabulary]);
  const [usedWords, setUsedWords] = useState([]);
  const [currentWord, setCurrentWord] = useState(null);
  const [userAnswer, setUserAnswer] = useState('');
  const [score, setScore] = useState(0);
  const [totalQuestions, setTotalQuestions] = useState(0);
  const [feedback, setFeedback] = useState('');
  const [speechSupported, setSpeechSupported] = useState(true);
  const [isReadyForNextWord, setIsReadyForNextWord] = useState(false);

  useEffect(() => {
    if (!('speechSynthesis' in window)) {
      setSpeechSupported(false);
    }
  }, []);

  const selectRandomWord = () => {
    if (vocabulary.length === 0) {
      setVocabulary([...initialVocabulary]);
      setUsedWords([]);
    }

    const availableWords = vocabulary.filter(
      word => !usedWords.includes(word.english)
    );

    if (availableWords.length > 0) {
      const randomWord = availableWords[Math.floor(Math.random() * availableWords.length)];
      setCurrentWord(randomWord);
      setUserAnswer('');
      setFeedback('');
      setIsReadyForNextWord(false);
    }
  };

  const playWordPronunciation = () => {
    if (!speechSupported) return;

    if (isReadyForNextWord) {
      selectRandomWord();
    } else if (currentWord) {
      const utterance = new SpeechSynthesisUtterance(currentWord.english);
      utterance.lang = 'en-US';
      window.speechSynthesis.speak(utterance);
    }
  };

  const checkAnswer = () => {
    setTotalQuestions(total => total + 1);
    
    const isCorrect = 
      userAnswer.trim() === currentWord.hebrew || 
      (currentWord.alternativeAnswers && 
       currentWord.alternativeAnswers.includes(userAnswer.trim()));

    if (isCorrect) {
      setScore(prevScore => prevScore + 1);
      setUsedWords(prev => [...prev, currentWord.english]);
      setVocabulary(prev => 
        prev.filter(word => word.english !== currentWord.english)
      );

      const allValidAnswers = [currentWord.hebrew, ...(currentWord.alternativeAnswers || [])];
      setFeedback(` ! 转砖  \n 转: ${currentWord.english}\n转砖转 驻砖专转: ${allValidAnswers.join(', ')}`);
      setIsReadyForNextWord(true);
    } else {
      const allValidAnswers = [currentWord.hebrew, ...(currentWord.alternativeAnswers || [])];
      setFeedback(`驻住! 转砖转 驻砖专转 : ${allValidAnswers.join(', ')}\n 转: ${currentWord.english}`);
      setIsReadyForNextWord(false);
    }
  };

  useEffect(() => {
    selectRandomWord();
  }, []);

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-blue-50 p-4">
      <div className="bg-white shadow-lg rounded-lg p-6 w-full max-w-md">
        <h1 className="text-2xl font-bold text-center mb-4"> 转 - </h1>
        
        {!speechSupported && (
          <p className="text-red-500 text-center mb-4">
            驻驻   转 拽专转 拽住
          </p>
        )}

        {currentWord && (
          <>
            <div className="flex justify-center mb-4">
              <Button 
                onClick={playWordPronunciation} 
                disabled={!speechSupported}
                className={`
                  ${isReadyForNextWord 
                    ? 'bg-blue-500 hover:bg-blue-600' 
                    : 'bg-blue-500 hover:bg-blue-600'
                  } 
                  text-white disabled:opacity-50
                `}
              >
                {isReadyForNextWord ? '抓  ' : ' '}
              </Button>
            </div>

            <Input 
              placeholder="拽 转 转专 注专转"
              value={userAnswer}
              onChange={(e) => setUserAnswer(e.target.value)}
              className="mb-4 text-center"
              disabled={isReadyForNextWord}
            />

            <Button 
              onClick={checkAnswer} 
              disabled={isReadyForNextWord}
              className="w-full bg-green-500 text-white hover:bg-green-600 disabled:opacity-50"
            >
              拽 转砖
            </Button>

            {feedback && (
              <div className={`mt-4 text-center p-2 rounded whitespace-pre-line ${
                feedback.includes(' ') ? 'bg-green-100' : 'bg-red-100'
              }`}>
                {feedback}
              </div>
            )}
          </>
        )}

        <div className="mt-4 text-center">
          <p>拽: {score} / {totalQuestions}</p>
          <p> 砖转专: {vocabulary.length}</p>
        </div>
      </div>
    </div>
  );
};

export default EnglishLearningApp;



